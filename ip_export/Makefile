SHELL := /bin/bash
VIVADO_VER           := 2023.2

SRC_XIL=source /tools/Xilinx/Vivado/${VIVADO_VER}/settings64.sh
export PYTHON=python3.11

help: info
	@echo
	@echo "Help"
	@echo "  - clean"
	@echo "  - info"
	@echo "  - compile"
	@echo "  - elaborate"
	@echo "  - simulate"
	@echo "  - waveform"


clean:
	@echo "Cleaning"
	rm -rf build
	cd sim && rm -f *.log *.jou *.pb
	cd sim && rm -rf xsim.dir

install_deps:
	${PYTHON} -m pip install pysv==0.2.0
	#${PYTHON} -m pip install attrs==23.1.0

py_codegen:
	${PYTHON} ./filter_msg_gen.py
	mv pysv_pkg.sv ./sim

compile: py_codegen
	@echo "  - Compiling"
	${SRC_XIL} && cd sim && ./compile.sh

elaborate: compile
	@echo "  - Elaborating"
	${SRC_XIL} && cd sim && ./elaborate.sh

simulate: elaborate
	@echo "  - Simulating"
	${SRC_XIL} && cd sim && ./simulate.sh

waveform:
	@echo
	@echo " - Displaying waveform"
	@echo " xsim --gui ./sim/autogenerated_tb_func_synth.wdb"
	${SRC_XIL} && cd sim && \
		xsim --gui ./autogenerated_tb_func_synth.wdb \
		--view ./autogenerated_tb_func_synth.wcfg

wave: waveform
